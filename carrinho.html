<!DOCTYPE html>
<html>
  <head>
    <title>Web Cliente</title>
    <meta charset="utf-8" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
  </head>
  <body>
    <!-- cabecalho -->
    <div id="cabecalho" class="container">
      <div class="container no-padding line-top"></div>
      <div class="container bg-light no-padding" style="padding-top: 30px">
        <nav class="navbar navbar-light">
          <div class="container-fluid no-padding margem">
            <a class="navbar-brand"><h2 class="titulo">Web-Cliente</h2></a>
            <form class="d-flex">
              <input
                class="form-control me-2"
                type="search"
                placeholder=""
                aria-label="Search"
              />
              <button class="btn btn-success btn-color" type="submit">
                Pesquisar
              </button>
            </form>
          </div>
          <p class="margem" style="color: #a1a1a1">
            Universidade Tecnológica Federal do Paraná
          </p>
        </nav>
        <!-- //navbar -->
        <nav id="menu" class="navbar navbar-expand-lg navbar-light margem">
          <div class="container-fluid" style="padding: 0; background: white">
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <div class="navbar-nav">
                <a class="nav-link" aria-current="page" href="index.html"
                  >Home</a
                >
                <a class="nav-link" href="#">Blog</a>
                <a class="nav-link" href="produtos.html">Produtos</a>
                <a class="nav-link" href="contato.html">Contatos</a>
                <a class="nav-link active" href="carrinho.html">Carrinho</a>
              </div>
            </div>
          </div>
        </nav>
        <!-- //navbar -->
      </div>
    </div>
    <!-- //cabecalho -->
    <div class="container">
      <div class="margem bg-white">
        <div class="row">
          <!-- produtos -->
          <div class="col-8 align-self-start mt-3">
            <table class="table">
              <thead>
                <tr>
                  <th class="col-md-8" scope="col">produto</th>
                  <th class="col-md-2 mx-auto" scope="col">qtd.</th>
                  <th class="col-md-3 mx-auto" scope="col">preço</th>
                </tr>
              </thead>
              <tbody id="carrinho-produtos">
                <tr value="prodid" class="align-middle">
                  <td>
                    <div>
                      <img class="w-25" src="images/produto1.jpeg ">
                      <span class="title"> Tenis nike </span>
                    </div> 
                  </td>
                  <td>
                    <input class="d-block" type="number" min="1" value="1">
                    <a class="d-block text-center" href="">remover</a>
                  </td>
                  <td>R$ 0,00</td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- //produtos -->
          <!--resumo-->
          <div class="col-4 pt-3">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Resumo do Pedido</h5>
                <p class="card-text">
                <div class="row">
                  <div class="col">
                    Total
                  </div>
                  <div id="produto-total" class="col text-end">
                    R$ 0,00
                  </div>
                </div>
                </p>
                <a href="#" class="btn btn-success btn-color w-100">Continuar</a>
              </div>
            </div>
          </div>
          <!--//resumo-->
        </div>
      </div>
    </div>
    <!-- //img carrinho -->
    <div class="container">
      <div id="rodape-separador" class="container bg-white no-padding">
        <div class="container no-padding line-bottom"></div>
      </div>
      <div id="rodape" class="container margem no-padding">
        <div class="row qx-5">
          <div class="col">
            <div>
              <div>
                <h4 style="margin-bottom: 0">Categorias</h4>
                <div class="line-top"></div>
              </div>
              <a href="">Categoria 1</a>
              <hr />
              <a href="">Categoria 2</a>
              <hr />
              <a href="">Categoria 3</a>
              <hr />
            </div>
          </div>
          <div class="col">
            <div>
              <div>
                <h4 style="margin-bottom: 0">Posts Recentes</h4>
                <div class="line-top"></div>
              </div>
              <a href="">Categoria 1</a>
              <hr />
              <a href="">Categoria 2</a>
              <hr />
              <a href="">Categoria 3</a>
              <hr />
            </div>
          </div>
          <div class="col">
            <div>
              <div>
                <h4 style="margin-bottom: 0">Contatos</h4>
                <div class="line-top"></div>
              </div>
              <a href="">Informação 1</a>
              <hr />
              <a href="">Informação 2</a>
              <hr />
              <a href="">Informação 3</a>
              <hr />
              <a href="">Informação 4</a>
              <hr />
              <a href="">Informação 5</a>
              <hr />
            </div>
          </div>
        </div>
      </div>
      <div class="container no-padding line-top"></div>
      <nav id="rodape-bot" class="navbar navbar-light bg-light margem">
        <div class="navbar ms-auto">
          <a class="nav-link" href="#">Blog</a>
          <a class="nav-link" href="#">Suporte</a>
          <a class="nav-link" href="#">Contatos</a>
        </div>
      </nav>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8"
      crossorigin="anonymous"
    ></script>
    <script>
      var total = 0;
      function getKeyByIndex(index){
        return localStorage.key(index);
      }
      function getDataByIndex(index){
        return JSON.parse(localStorage.getItem(getKeyByIndex(index)));
      }
      function carregarCarrinho(){
        var carrinho = document.getElementById("carrinho-produtos");
        var data = "";
        total = 0;
        for(var i=0; i<localStorage.length; i++){
          var produto = getDataByIndex(i);
          total += produto.preco * produto.qtd;
          data +=  "<tr value='prodid' class='align-middle'><td><div><img class='w-25' src='"+produto.img +"'><span>"+ produto.nome +"</span></div></td><td><input class='d-block' type='number' min='1' value='"+produto.qtd +"' onchange='atualizarProduto("+i+", this.value)' style='width: 3em;'><div class=''><a onclick='removerProduto("+i+")' href=''>remover</a></div></td><td id='valor"+i+"'>" + formatarValor(produto.preco * produto.qtd) + "</td></tr>"
        }
        carrinho.innerHTML = data;
        document.getElementById("produto-total").innerHTML = formatarValor(total);
      }
      function removerProduto(id){
        localStorage.removeItem(getKeyByIndex(id));
        carregarCarrinho();
      }
      function atualizarProduto(id, value){
        if(/^([0-9]+)$/.test(value)){
          var produto = getDataByIndex(id);
          produto.qtd = value;
          localStorage.setItem(getKeyByIndex(id), JSON.stringify(produto));
          document.getElementById("valor"+id).innerHTML = formatarValor(produto.preco * produto.qtd);
          atulizarTotal();
        } else{
          carregarCarrinho();
        }
      }
      function atulizarTotal(){
        total = 0;
        for(var i=0;i<localStorage.length;i++) {
          produto = getDataByIndex(i);
          total += produto.preco * produto.qtd; 
        }
        document.getElementById("produto-total").innerHTML = formatarValor(total);
      }
      function formatarValor(num){
        var nString= num.toString().split(".");
        return "R$ " + nString[0] + "." + nString[1].substring(0,2);
      }
      carregarCarrinho();
    </script>
  </body>
</html>
